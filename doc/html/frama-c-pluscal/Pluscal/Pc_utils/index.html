<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Pc_utils (frama-c-pluscal.Pluscal.Pc_utils)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0_beta1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">frama-c-pluscal</a> &#x00BB; <a href="../index.html">Pluscal</a> &#x00BB; Pc_utils</nav><header class="odoc-preamble"><h1>Module <code><span>Pluscal.Pc_utils</span></code></h1><p>Utilities for generating PlusCal program. *</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-exp_to_str"><a href="#val-exp_to_str" class="anchor"></a><code><span><span class="keyword">val</span> exp_to_str : <span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.exp_node <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Converts an expression to its string representation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">exp</span> <p>The expression to convert.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>A string representing the expression. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-instr_to_str"><a href="#val-instr_to_str" class="anchor"></a><code><span><span class="keyword">val</span> instr_to_str : <span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.instr <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Converts an instruction to its string representation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">instr</span> <p>The instruction to convert.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>A string representing the instruction. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stmt_to_str"><a href="#val-stmt_to_str" class="anchor"></a><code><span><span class="keyword">val</span> stmt_to_str : <span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.stmtkind <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Converts a statement to its string representation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stmt</span> <p>The statement to convert.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>A string representing the statement. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_file_name"><a href="#val-get_file_name" class="anchor"></a><code><span><span class="keyword">val</span> get_file_name : <span>unit <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Retrieves the base name of the first file in the list of files managed by the Kernel.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>A string representing the base name of the first file. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_entry_point"><a href="#val-get_entry_point" class="anchor"></a><code><span><span class="keyword">val</span> get_entry_point : <span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.file <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns the name of the entry point function in the given file <code>f</code>. The entry point is determined by finding the last function definition in the file's global declarations.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">f</span> <p>The file to search for the entry point.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>The name of the entry point function. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_binop_ptr"><a href="#val-is_binop_ptr" class="anchor"></a><code><span><span class="keyword">val</span> is_binop_ptr : <span><a href="../Pc/index.html#type-pc_binop">Pc.pc_binop</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Checks if a given binary operation is a pointer operation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">b</span> <p>binary operation to check.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Boolean</code> telling if the operation is on pointer or not. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_pc_cst"><a href="#val-add_pc_cst" class="anchor"></a><code><span><span class="keyword">val</span> add_pc_cst : <span><a href="../Pc/index.html#type-pc_expr">Pc.pc_expr</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../Pc/index.html#type-pc_expr">Pc.pc_expr</a></span></code></div><div class="spec-doc"><p>Adds the integer <code>n</code> to the integer constant in an pc_expr <code>e</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">e</span> <p><code>pc_expr</code> to which the integer <code>n</code> will be added.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">n</span> <p>integer to add to the constant within <code>e</code>.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>pc_expr</code> with the integer <code>n</code> added to the constant, or the original <code>e</code> if it is not a <code>PCst (PInt (i))</code>. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-vname_to_string"><a href="#val-vname_to_string" class="anchor"></a><code><span><span class="keyword">val</span> vname_to_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Computes the variable name in the PlusCal representation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">proc_name</span> <p>name of the procedure.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">vname</span> <p>name of the variable.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> that combines the variable name, &quot;_ptr_&quot;, and the procedure name.</p></li></ul><p>Useful to dump procedure variables section. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-arg_to_string"><a href="#val-arg_to_string" class="anchor"></a><code><span><span class="keyword">val</span> arg_to_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../Pc/index.html#type-pc_var">Pc.pc_var</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Computes the argument name in the PlusCal representation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">proc_name</span> <p>name of the procedure.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">vname</span> <p>name of the argument.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> that combines <code>vname</code>, an underscore, and <code>proc_name</code>.</p></li></ul><p>Useful to dump procedure arguments. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ptr_to_string"><a href="#val-ptr_to_string" class="anchor"></a><code><span><span class="keyword">val</span> ptr_to_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../Pc/index.html#type-pc_ptr">Pc.pc_ptr</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Converts a pointer PlusCal representation to a string.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">proc_name</span> <p>name of the procedure.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">(ptr_name,</span> <p>glob) tuple where <code>ptr_name</code> is the name of the pointer and <code>glob</code> is a boolean indicating if the pointer is global.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> representation of the pointer in the format &quot;ptr_name_ptr_suffix&quot;, where suffix is either &quot;glob&quot; if the pointer is global, or the procedure name if it is not.</p></li></ul><p>Useful to dump pointer in the program core. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dump_list"><a href="#val-dump_list" class="anchor"></a><code><span><span class="keyword">val</span> dump_list : 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Recursively prints the elements of a list <code>l</code> to the formatter <code>out</code> using the function <code>dump_fun</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">out</span> <p>formatter to output the list elements.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">l</span> <p>list of elements to be printed.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dump_fun</span> <p>function used to print each element of the list.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>unit.</p></li></ul><p>Each element is separated by a comma, except for the last element. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_indent"><a href="#val-string_of_indent" class="anchor"></a><code><span><span class="keyword">val</span> string_of_indent : <span>int <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Computes a string consisting of <code>n * 4</code> spaces.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">n</span> <p>number of indentation levels.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> with <code>n * 4</code> spaces.</p></li></ul><p>Useful for creating indentation in formatted output. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_indent"><a href="#val-add_indent" class="anchor"></a><code><span><span class="keyword">val</span> add_indent : <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Computes a new string with <code>n * 4</code> spaces concatened to the given <code>indent</code> string.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">n</span> <p>number of indentation levels.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">indent</span> <p>The string to which the indentation will be added.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> with the wanted indentation. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_last_char"><a href="#val-remove_last_char" class="anchor"></a><code><span><span class="keyword">val</span> remove_last_char : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Removes the last character from the string <code>s</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">s</span> <p>input string from which the last character will be removed.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String</code> with the last character removed, or the original string if it is empty.</p></li></ul><p>Useful to remove &quot;:&quot; from labels. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-procedure_push_vars"><a href="#val-procedure_push_vars" class="anchor"></a><code><span><span class="keyword">val</span> procedure_push_vars : 
  <span><span>(<span><a href="../Pc/index.html#type-pc_instr">Pc.pc_instr</a> list</span> * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Pc/index.html#type-pc_var">Pc.pc_var</a> * <span>int option</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(bool * <span>int list</span> * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Pc/index.html#type-pc_instr">Pc.pc_instr</a> list</span> * int</span></code></div><div class="spec-doc"><p>Recursively processes a list of variables and generates a list of declarations and initializations.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">acc</span> <p>tuple containing the current list of declarations and the number of declarations.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">vars</span> <p>list of tuples where each tuple contains a variable name and an optional array size.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">args_info</span> <p>tuple containing a boolean indicating if the variables are arguments, a list of indices for array arguments, and the number of arguments.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Pc_instr list, Integer</code> tuple containing the updated list of declarations and the number of declarations.</p></li></ul><p>The number of declarations is useful to return to generate the right number of pop instructions later.</p><p>We can not use <code>is_args</code> variable in the case of an array, because Frama-C transforms them as pointer when called in a function, then the variable will not be considerd as an array and will have <code>None</code> as array size. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-procedure_pop"><a href="#val-procedure_pop" class="anchor"></a><code><span><span class="keyword">val</span> procedure_pop : <span><span><a href="../Pc/index.html#type-pc_instr">Pc.pc_instr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../Pc/index.html#type-pc_instr">Pc.pc_instr</a> list</span></span></code></div><div class="spec-doc"><p>Recursively generates a list of pop operations.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">acc</span> <p>current list of operations.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">n</span> <p>number of pop operations to generate.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Pc_instr list</code> of operations with the specified number of pop operations added. *</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-varinfo_is_array"><a href="#val-varinfo_is_array" class="anchor"></a><code><span><span class="keyword">val</span> varinfo_is_array : <span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.varinfo <span class="arrow">&#45;&gt;</span></span> string * <span>int option</span></span></code></div><div class="spec-doc"><p>Converts a variable information into a representation, with information if it is an array or not.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">v</span> <p>variable information record of type <code>varinfo</code>.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>String, Int option</code> tuple containing the original name of the variable and an optional length of the array if the variable is of array type.</p></li></ul><p>Useful to generate init_array operations. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-detect_array_args"><a href="#val-detect_array_args" class="anchor"></a><code><span><span class="keyword">val</span> detect_array_args : 
  <span><span><span>(string, int)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.stmt list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Detects all the StartOf operations (i.e., array conversion to pointer) in function calls within a list of statements and adds the array argument indices to a hashtable with the function name as the key.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">array_args_table</span> <p>hashtable with the function name as the key and a list of argument indices as the value.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stmts</span> <p>list of statements to analyze.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>unit.</p></li></ul><p>The hashtable will be modified in place and do not need to be returned. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_all_array_args"><a href="#val-get_all_array_args" class="anchor"></a><code><span><span class="keyword">val</span> get_all_array_args : 
  <span><span><span>(string, int)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Frama_c_kernel</span>.Cil_types.global list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Iterates over all global definitions to find functions and detect array arguments in their statements.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">array_args_table</span> <p>hashtable with the function name as the key and a list of argument indices as the value.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">globals</span> <p>list of global definitions to analyze.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>unit.</p></li></ul><p>The hashtable will be modified in place and do not need to be returned. *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_left_result"><a href="#val-fold_left_result" class="anchor"></a><code><span><span class="keyword">val</span> fold_left_result : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'d</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'d</span>, <span class="type-var">'c</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p>Folds a function <code>f</code> over a list <code>l</code> with an initial accumulator <code>init_acc</code>. If any application of <code>f</code> returns an error, the folding process stops and returns the error. Otherwise, it combines the results using the function <code>g</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">f</span> <p>function that takes an element of the list and returns a result.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">g</span> <p>function that combines the accumulator and the result of <code>f</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">init_acc</span> <p>initial value of the accumulator.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">l</span> <p>list to fold over.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Result</code> containing the final accumulated value or an error. *</p></li></ul></div></div></div></body></html>
